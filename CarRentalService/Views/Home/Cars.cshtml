@model CarRentalService.Models.CarsViewModel
@using CarRentalService.Models

@{
    ViewData["Title"] = "Cars";
}

<div class="container mt-4 mb-5">

    <h1 class="mb-4">Cars</h1>

    <form asp-action="Cars" asp-controller="Home" method="post">
        @Html.AntiForgeryToken()

        <div asp-validation-summary="All" class="text-danger mb-3"></div>

        <div class="row mb-4">

            <div class="col-md-4">
                <label asp-for="Search.Pickup" class="form-label"></label>
                <input asp-for="Search.Pickup" type="date" class="form-control" />
                <span asp-validation-for="Search.Pickup" class="text-danger"></span>
            </div>

            <div class="col-md-4">
                <label asp-for="Search.Return" class="form-label"></label>
                <input asp-for="Search.Return" type="date" class="form-control" />
                <span asp-validation-for="Search.Return" class="text-danger"></span>
            </div>

            <div class="col-md-4 d-flex align-items-end">
                <button type="submit" class="btn btn-danger w-100">
                    Search
                </button>
            </div>

        </div>

        @if (TempData["Msg"] != null)
        {
            <div class="alert alert-success">
                @TempData["Msg"]
            </div>
        }

        @if (Model.ShowVehicles)
        {
            <hr />

            <div class="card shadow-sm mb-4">
                <div class="card-header fw-bold">
                    Choose insurance
                </div>

                <div class="card-body">

                    <div class="form-check mb-3 p-3 border rounded">
                        <input class="form-check-input"
                               asp-for="Search.SelectedInsurancePlan"
                               type="radio"
                               value="Basic"
                               id="basicPlan" />

                        <label class="form-check-label w-100" for="basicPlan">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>BASIC protect</strong><br />
                                    <small class="text-muted">
                                        ✔ Basic liability coverage<br />
                                        ✔ Mandatory insurance included<br />
                                        ✖ No damage reduction
                                    </small>
                                </div>
                                <div class="fw-bold">
                                    0 € / day
                                </div>
                            </div>
                        </label>
                    </div>

                    <div class="form-check mb-3 p-3 border rounded">
                        <input class="form-check-input"
                               asp-for="Search.SelectedInsurancePlan"
                               type="radio"
                               value="Medium"
                               id="mediumPlan" />

                        <label class="form-check-label w-100" for="mediumPlan">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>MEDIUM protect</strong><br />
                                    <small class="text-muted">
                                        ✔ Reduced damage liability<br />
                                        ✔ Passenger insurance<br />
                                        ✔ Partial theft protection
                                    </small>
                                </div>
                                <div class="fw-bold">
                                    17 € / day
                                </div>
                            </div>
                        </label>
                    </div>

                    <div class="form-check p-3 border rounded">
                        <input class="form-check-input"
                               asp-for="Search.SelectedInsurancePlan"
                               type="radio"
                               value="Total"
                               id="totalPlan" />

                        <label class="form-check-label w-100" for="totalPlan">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <strong>TOTAL protect</strong><br />
                                    <small class="text-muted">
                                        ✔ Full damage coverage<br />
                                        ✔ Theft protection<br />
                                        ✔ No excess / no hidden costs
                                    </small>
                                </div>
                                <div class="fw-bold">
                                    22 € / day
                                </div>
                            </div>
                        </label>
                    </div>

                    <span asp-validation-for="Search.SelectedInsurancePlan"
                          class="text-danger d-block mt-2"></span>

                </div>
            </div>


            <div class="d-flex mb-4 align-items-center">

                <div class="me-3">
                    <button type="submit" name="Category" value="All offers" class="btn btn-outline-dark btn-sm">
                        All offers
                    </button>

                    @foreach (var c in Model.Categories.Where(x => x != "All offers"))
                    {
                        <button type="submit" name="Category" value="@c" class="btn btn-outline-dark btn-sm">
                            @c
                        </button>
                    }
                </div>

                <div class="ms-auto">
                    <select name="Sort" onchange="this.form.submit()" class="form-select form-select-sm">
                        <option value="">Sort by</option>
                        <option value="price_asc" selected="@(Model.Sort == "price_asc")">
                            Price (lowest)
                        </option>
                        <option value="price_desc" selected="@(Model.Sort == "price_desc")">
                            Price (highest)
                        </option>
                    </select>
                </div>

            </div>

            @if (!Model.Vehicles.Any())
            {
                <p>No vehicles found.</p>
            }
            else
            {
                <div class="row">
                    @foreach (var item in Model.Vehicles)
                    {
                        <div class="col-md-3 mb-4">
                            <div class="card h-100 @(item.Available <= 0 ? "opacity-50" : "")">

                                <img src="~/images/@item.Vehicle.ImageUrl"
                                     class="card-img-top vehicle-img"
                                     alt="@item.Vehicle.Brand @item.Vehicle.Model" />

                                <div class="card-body">
                                    <h5>@item.Vehicle.Brand @item.Vehicle.Model</h5>
                                    <p><b>@item.Vehicle.DailyPrice €</b> / day</p>
                                    <p>Available: <b>@item.Available</b></p>

                                    @if (item.Available > 0)
                                    {
                                        <button type="submit"
                                                name="VehicleId"
                                                value="@item.Vehicle.Id"
                                                formaction="@Url.Action("Rent", "Home")"
                                                class="btn btn-danger w-100">
                                            RENT NOW
                                        </button>
                                    }
                                    else
                                    {
                                        <button type="button"
                                                class="btn btn-secondary w-100"
                                                disabled>
                                            NOT AVAILABLE
                                        </button>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
        }

    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="~/js/cars.js" asp-append-version="true"></script>
}
